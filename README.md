# nginx-lmdb-queue
nginx module to write data into lmdb-queue

## HOW TO BUILD
```sh
# In nginx source path, execute:
./configure --add-module=/path/to/nginx-lmdb-queue
# Nginx configure doesn't configure CXXFLAGS, so we have to this:
mv objs/Makefile objs/Makefile.old; sed 's/\t\t\(nginx-lmdb-queue\/src\/.*\.cc\)/\t\t-std=c++11 \1/' objs/Makefile.old > objs/Makefile
make -j
```

## Directives
```
Declare a queue:
Syntax: lmdb_queue 'queue_path';
Context: http
Example: lmdb_queue '/home/user/queue';
```

```
Declare a topic:
Syntax: lmdb_queue_topic 'topic_name' chunkSize[g|m] chunksToKeep;
Context: http
Example: lmdb_queue_topic ng_remote 2g 400;
```

```
Push msg to queue:
Syntax: lmdb_queue_push 'topic_name' 'data_format';
Context: location
Example: lmdb_queue_push ng_remote '$json_header\0$request_body';   # $json_header is a json string var generated by lua.
```
